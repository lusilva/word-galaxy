[{"type":"js","data":"(function () {\n\n/* Imports */\nvar Meteor = Package.meteor.Meteor;\nvar WebApp = Package.webapp.WebApp;\nvar main = Package.webapp.main;\nvar WebAppInternals = Package.webapp.WebAppInternals;\nvar _ = Package.underscore._;\n\n/* Package-scope variables */\nvar PickerImp, Picker;\n\n(function(){\n\n//////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                      //\n// packages/meteorhacks_picker/packages/meteorhacks_picker.js                           //\n//                                                                                      //\n//////////////////////////////////////////////////////////////////////////////////////////\n                                                                                        //\n(function () {                                                                          // 1\n                                                                                        // 2\n///////////////////////////////////////////////////////////////////////////////////     // 3\n//                                                                               //     // 4\n// packages/meteorhacks:picker/lib/implementation.js                             //     // 5\n//                                                                               //     // 6\n///////////////////////////////////////////////////////////////////////////////////     // 7\n                                                                                 //     // 8\nvar pathToRegexp = Npm.require('path-to-regexp');                                // 1   // 9\nvar Fiber = Npm.require('fibers');                                               // 2   // 10\nvar urlParse = Npm.require('url').parse;                                         // 3   // 11\n                                                                                 // 4   // 12\nPickerImp = function(filterFunction) {                                           // 5   // 13\n  this.filterFunction = filterFunction;                                          // 6   // 14\n  this.routes = [];                                                              // 7   // 15\n  this.subRouters = [];                                                          // 8   // 16\n  this.middlewares = [];                                                         // 9   // 17\n}                                                                                // 10  // 18\n                                                                                 // 11  // 19\nPickerImp.prototype.middleware = function(callback) {                            // 12  // 20\n  this.middlewares.push(callback);                                               // 13  // 21\n};                                                                               // 14  // 22\n                                                                                 // 15  // 23\nPickerImp.prototype.route = function(path, callback) {                           // 16  // 24\n  var regExp = pathToRegexp(path);                                               // 17  // 25\n  regExp.callback = callback;                                                    // 18  // 26\n  this.routes.push(regExp);                                                      // 19  // 27\n  return this;                                                                   // 20  // 28\n};                                                                               // 21  // 29\n                                                                                 // 22  // 30\nPickerImp.prototype.filter = function(callback) {                                // 23  // 31\n  var subRouter = new PickerImp(callback);                                       // 24  // 32\n  this.subRouters.push(subRouter);                                               // 25  // 33\n  return subRouter;                                                              // 26  // 34\n};                                                                               // 27  // 35\n                                                                                 // 28  // 36\nPickerImp.prototype._dispatch = function(req, res, bypass) {                     // 29  // 37\n  var self = this;                                                               // 30  // 38\n  var currentRoute = 0;                                                          // 31  // 39\n  var currentSubRouter = 0;                                                      // 32  // 40\n  var currentMiddleware = 0;                                                     // 33  // 41\n                                                                                 // 34  // 42\n  if(this.filterFunction) {                                                      // 35  // 43\n    var result = this.filterFunction(req, res);                                  // 36  // 44\n    if(!result) {                                                                // 37  // 45\n      return bypass();                                                           // 38  // 46\n    }                                                                            // 39  // 47\n  }                                                                              // 40  // 48\n                                                                                 // 41  // 49\n  processNextMiddleware();                                                       // 42  // 50\n  function processNextMiddleware () {                                            // 43  // 51\n    var middleware = self.middlewares[currentMiddleware++];                      // 44  // 52\n    if(middleware) {                                                             // 45  // 53\n      self._processMiddleware(middleware, req, res, processNextMiddleware);      // 46  // 54\n    } else {                                                                     // 47  // 55\n      processNextRoute();                                                        // 48  // 56\n    }                                                                            // 49  // 57\n  }                                                                              // 50  // 58\n                                                                                 // 51  // 59\n  function processNextRoute () {                                                 // 52  // 60\n    var route = self.routes[currentRoute++];                                     // 53  // 61\n    if(route) {                                                                  // 54  // 62\n      var uri = req.url.replace(/\\?.*/, '');                                     // 55  // 63\n      var m = uri.match(route);                                                  // 56  // 64\n      if(m) {                                                                    // 57  // 65\n        var params = self._buildParams(route.keys, m);                           // 58  // 66\n        params.query = urlParse(req.url, true).query;                            // 59  // 67\n        self._processRoute(route.callback, params, req, res, bypass);            // 60  // 68\n      } else {                                                                   // 61  // 69\n        processNextRoute();                                                      // 62  // 70\n      }                                                                          // 63  // 71\n    } else {                                                                     // 64  // 72\n      processNextSubRouter();                                                    // 65  // 73\n    }                                                                            // 66  // 74\n  }                                                                              // 67  // 75\n                                                                                 // 68  // 76\n  function processNextSubRouter () {                                             // 69  // 77\n    var subRouter = self.subRouters[currentSubRouter++];                         // 70  // 78\n    if(subRouter) {                                                              // 71  // 79\n      subRouter._dispatch(req, res, processNextSubRouter);                       // 72  // 80\n    } else {                                                                     // 73  // 81\n      bypass();                                                                  // 74  // 82\n    }                                                                            // 75  // 83\n  }                                                                              // 76  // 84\n};                                                                               // 77  // 85\n                                                                                 // 78  // 86\nPickerImp.prototype._buildParams = function(keys, m) {                           // 79  // 87\n  var params = {};                                                               // 80  // 88\n  for(var lc=1; lc<m.length; lc++) {                                             // 81  // 89\n    var key = keys[lc-1].name;                                                   // 82  // 90\n    var value = m[lc];                                                           // 83  // 91\n    params[key] = value;                                                         // 84  // 92\n  }                                                                              // 85  // 93\n                                                                                 // 86  // 94\n  return params;                                                                 // 87  // 95\n};                                                                               // 88  // 96\n                                                                                 // 89  // 97\nPickerImp.prototype._processRoute = function(callback, params, req, res, next) { // 90  // 98\n  if(Fiber.current) {                                                            // 91  // 99\n    doCall();                                                                    // 92  // 100\n  } else {                                                                       // 93  // 101\n    new Fiber(doCall).run();                                                     // 94  // 102\n  }                                                                              // 95  // 103\n                                                                                 // 96  // 104\n  function doCall () {                                                           // 97  // 105\n    callback.call(null, params, req, res, next);                                 // 98  // 106\n  }                                                                              // 99  // 107\n};                                                                               // 100\n                                                                                 // 101\nPickerImp.prototype._processMiddleware = function(middleware, req, res, next) {  // 102\n  if(Fiber.current) {                                                            // 103\n    doCall();                                                                    // 104\n  } else {                                                                       // 105\n    new Fiber(doCall).run();                                                     // 106\n  }                                                                              // 107\n                                                                                 // 108\n  function doCall() {                                                            // 109\n    middleware.call(null, req, res, next);                                       // 110\n  }                                                                              // 111\n};                                                                               // 112\n///////////////////////////////////////////////////////////////////////////////////     // 121\n                                                                                        // 122\n}).call(this);                                                                          // 123\n                                                                                        // 124\n                                                                                        // 125\n                                                                                        // 126\n                                                                                        // 127\n                                                                                        // 128\n                                                                                        // 129\n(function () {                                                                          // 130\n                                                                                        // 131\n///////////////////////////////////////////////////////////////////////////////////     // 132\n//                                                                               //     // 133\n// packages/meteorhacks:picker/lib/instance.js                                   //     // 134\n//                                                                               //     // 135\n///////////////////////////////////////////////////////////////////////////////////     // 136\n                                                                                 //     // 137\nPicker = new PickerImp();                                                        // 1   // 138\nWebApp.rawConnectHandlers.use(function(req, res, next) {                         // 2   // 139\n  Picker._dispatch(req, res, next);                                              // 3   // 140\n});                                                                              // 4   // 141\n                                                                                 // 5   // 142\n///////////////////////////////////////////////////////////////////////////////////     // 143\n                                                                                        // 144\n}).call(this);                                                                          // 145\n                                                                                        // 146\n//////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n/* Exports */\nif (typeof Package === 'undefined') Package = {};\nPackage['meteorhacks:picker'] = {\n  Picker: Picker\n};\n\n})();\n","servePath":"/packages/meteorhacks_picker.js","sourceMap":{"version":3,"sources":["/packages/meteorhacks_picker/packages/meteorhacks_picker.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8F","file":"/packages/meteorhacks_picker.js","sourcesContent":["(function () {\n\n///////////////////////////////////////////////////////////////////////////////////\n//                                                                               //\n// packages/meteorhacks:picker/lib/implementation.js                             //\n//                                                                               //\n///////////////////////////////////////////////////////////////////////////////////\n                                                                                 //\nvar pathToRegexp = Npm.require('path-to-regexp');                                // 1\nvar Fiber = Npm.require('fibers');                                               // 2\nvar urlParse = Npm.require('url').parse;                                         // 3\n                                                                                 // 4\nPickerImp = function(filterFunction) {                                           // 5\n  this.filterFunction = filterFunction;                                          // 6\n  this.routes = [];                                                              // 7\n  this.subRouters = [];                                                          // 8\n  this.middlewares = [];                                                         // 9\n}                                                                                // 10\n                                                                                 // 11\nPickerImp.prototype.middleware = function(callback) {                            // 12\n  this.middlewares.push(callback);                                               // 13\n};                                                                               // 14\n                                                                                 // 15\nPickerImp.prototype.route = function(path, callback) {                           // 16\n  var regExp = pathToRegexp(path);                                               // 17\n  regExp.callback = callback;                                                    // 18\n  this.routes.push(regExp);                                                      // 19\n  return this;                                                                   // 20\n};                                                                               // 21\n                                                                                 // 22\nPickerImp.prototype.filter = function(callback) {                                // 23\n  var subRouter = new PickerImp(callback);                                       // 24\n  this.subRouters.push(subRouter);                                               // 25\n  return subRouter;                                                              // 26\n};                                                                               // 27\n                                                                                 // 28\nPickerImp.prototype._dispatch = function(req, res, bypass) {                     // 29\n  var self = this;                                                               // 30\n  var currentRoute = 0;                                                          // 31\n  var currentSubRouter = 0;                                                      // 32\n  var currentMiddleware = 0;                                                     // 33\n                                                                                 // 34\n  if(this.filterFunction) {                                                      // 35\n    var result = this.filterFunction(req, res);                                  // 36\n    if(!result) {                                                                // 37\n      return bypass();                                                           // 38\n    }                                                                            // 39\n  }                                                                              // 40\n                                                                                 // 41\n  processNextMiddleware();                                                       // 42\n  function processNextMiddleware () {                                            // 43\n    var middleware = self.middlewares[currentMiddleware++];                      // 44\n    if(middleware) {                                                             // 45\n      self._processMiddleware(middleware, req, res, processNextMiddleware);      // 46\n    } else {                                                                     // 47\n      processNextRoute();                                                        // 48\n    }                                                                            // 49\n  }                                                                              // 50\n                                                                                 // 51\n  function processNextRoute () {                                                 // 52\n    var route = self.routes[currentRoute++];                                     // 53\n    if(route) {                                                                  // 54\n      var uri = req.url.replace(/\\?.*/, '');                                     // 55\n      var m = uri.match(route);                                                  // 56\n      if(m) {                                                                    // 57\n        var params = self._buildParams(route.keys, m);                           // 58\n        params.query = urlParse(req.url, true).query;                            // 59\n        self._processRoute(route.callback, params, req, res, bypass);            // 60\n      } else {                                                                   // 61\n        processNextRoute();                                                      // 62\n      }                                                                          // 63\n    } else {                                                                     // 64\n      processNextSubRouter();                                                    // 65\n    }                                                                            // 66\n  }                                                                              // 67\n                                                                                 // 68\n  function processNextSubRouter () {                                             // 69\n    var subRouter = self.subRouters[currentSubRouter++];                         // 70\n    if(subRouter) {                                                              // 71\n      subRouter._dispatch(req, res, processNextSubRouter);                       // 72\n    } else {                                                                     // 73\n      bypass();                                                                  // 74\n    }                                                                            // 75\n  }                                                                              // 76\n};                                                                               // 77\n                                                                                 // 78\nPickerImp.prototype._buildParams = function(keys, m) {                           // 79\n  var params = {};                                                               // 80\n  for(var lc=1; lc<m.length; lc++) {                                             // 81\n    var key = keys[lc-1].name;                                                   // 82\n    var value = m[lc];                                                           // 83\n    params[key] = value;                                                         // 84\n  }                                                                              // 85\n                                                                                 // 86\n  return params;                                                                 // 87\n};                                                                               // 88\n                                                                                 // 89\nPickerImp.prototype._processRoute = function(callback, params, req, res, next) { // 90\n  if(Fiber.current) {                                                            // 91\n    doCall();                                                                    // 92\n  } else {                                                                       // 93\n    new Fiber(doCall).run();                                                     // 94\n  }                                                                              // 95\n                                                                                 // 96\n  function doCall () {                                                           // 97\n    callback.call(null, params, req, res, next);                                 // 98\n  }                                                                              // 99\n};                                                                               // 100\n                                                                                 // 101\nPickerImp.prototype._processMiddleware = function(middleware, req, res, next) {  // 102\n  if(Fiber.current) {                                                            // 103\n    doCall();                                                                    // 104\n  } else {                                                                       // 105\n    new Fiber(doCall).run();                                                     // 106\n  }                                                                              // 107\n                                                                                 // 108\n  function doCall() {                                                            // 109\n    middleware.call(null, req, res, next);                                       // 110\n  }                                                                              // 111\n};                                                                               // 112\n///////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n\n\n\n\n(function () {\n\n///////////////////////////////////////////////////////////////////////////////////\n//                                                                               //\n// packages/meteorhacks:picker/lib/instance.js                                   //\n//                                                                               //\n///////////////////////////////////////////////////////////////////////////////////\n                                                                                 //\nPicker = new PickerImp();                                                        // 1\nWebApp.rawConnectHandlers.use(function(req, res, next) {                         // 2\n  Picker._dispatch(req, res, next);                                              // 3\n});                                                                              // 4\n                                                                                 // 5\n///////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n"]}}]