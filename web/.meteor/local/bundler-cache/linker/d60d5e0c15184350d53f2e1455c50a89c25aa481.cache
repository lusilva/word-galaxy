[{"type":"js","data":"//////////////////////////////////////////////////////////////////////////\n//                                                                      //\n// This is a generated file. You can view the original                  //\n// source in your browser if your browser supports source maps.         //\n// Source maps are supported by all recent versions of Chrome, Safari,  //\n// and Firefox, and by Internet Explorer 11.                            //\n//                                                                      //\n//////////////////////////////////////////////////////////////////////////\n\n\n(function () {\n\n/* Imports */\nvar Meteor = Package.meteor.Meteor;\nvar InjectData = Package['meteorhacks:inject-data'].InjectData;\nvar Cookie = Package['chuangbo:cookie'].Cookie;\nvar LocalCollection = Package.minimongo.LocalCollection;\nvar Minimongo = Package.minimongo.Minimongo;\nvar _ = Package.underscore._;\nvar Tracker = Package.tracker.Tracker;\nvar Deps = Package.tracker.Deps;\nvar EJSON = Package.ejson.EJSON;\nvar Accounts = Package['accounts-base'].Accounts;\nvar AccountsClient = Package['accounts-base'].AccountsClient;\n\n/* Package-scope variables */\nvar AddedToChanged, ApplyDDP, DeepExtend, IDTools, FastRender, collData, __init_fast_render;\n\n(function(){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                //\n// packages/meteorhacks_fast-render/lib/utils.js                                                                  //\n//                                                                                                                //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                  //\nAddedToChanged = function(localCopy, added) {                                                                     // 1\n  added.msg = \"changed\";                                                                                          // 2\n  added.cleared = [];                                                                                             // 3\n  added.fields = added.fields || {};                                                                              // 4\n                                                                                                                  // 5\n  _.each(localCopy, function(value, key) {                                                                        // 6\n    if(key != '_id') {                                                                                            // 7\n      if(typeof added.fields[key] == \"undefined\") {                                                               // 8\n        added.cleared.push(key);                                                                                  // 9\n      }                                                                                                           // 10\n    }                                                                                                             // 11\n  });                                                                                                             // 12\n};                                                                                                                // 13\n                                                                                                                  // 14\nApplyDDP = function(existing, message) {                                                                          // 15\n  var newDoc = (!existing)? {}: _.clone(existing);                                                                // 16\n  if(message.msg == 'added') {                                                                                    // 17\n    _.each(message.fields, function(value, key) {                                                                 // 18\n      newDoc[key] = value;                                                                                        // 19\n    });                                                                                                           // 20\n  } else if(message.msg == \"changed\") {                                                                           // 21\n    _.each(message.fields, function(value, key) {                                                                 // 22\n      newDoc[key] = value;                                                                                        // 23\n    });                                                                                                           // 24\n    _.each(message.cleared, function(key) {                                                                       // 25\n      delete newDoc[key];                                                                                         // 26\n    });                                                                                                           // 27\n  } else if(message.msg == \"removed\") {                                                                           // 28\n    newDoc = null;                                                                                                // 29\n  }                                                                                                               // 30\n                                                                                                                  // 31\n  return newDoc;                                                                                                  // 32\n};                                                                                                                // 33\n                                                                                                                  // 34\n// source: https://gist.github.com/kurtmilam/1868955                                                              // 35\n//  modified a bit to not to expose this as an _ api                                                              // 36\nDeepExtend = function deepExtend (obj) {                                                                          // 37\n  var parentRE = /#{\\s*?_\\s*?}/,                                                                                  // 38\n      slice = Array.prototype.slice,                                                                              // 39\n      hasOwnProperty = Object.prototype.hasOwnProperty;                                                           // 40\n                                                                                                                  // 41\n  _.each(slice.call(arguments, 1), function(source) {                                                             // 42\n    for (var prop in source) {                                                                                    // 43\n      if (hasOwnProperty.call(source, prop)) {                                                                    // 44\n        if (_.isNull(obj[prop]) || _.isUndefined(obj[prop]) || _.isFunction(obj[prop]) || _.isNull(source[prop]) || _.isDate(source[prop])) {\n          obj[prop] = source[prop];                                                                               // 46\n        }                                                                                                         // 47\n        else if (_.isString(source[prop]) && parentRE.test(source[prop])) {                                       // 48\n          if (_.isString(obj[prop])) {                                                                            // 49\n            obj[prop] = source[prop].replace(parentRE, obj[prop]);                                                // 50\n          }                                                                                                       // 51\n        }                                                                                                         // 52\n        else if (_.isArray(obj[prop]) || _.isArray(source[prop])){                                                // 53\n          if (!_.isArray(obj[prop]) || !_.isArray(source[prop])){                                                 // 54\n            throw 'Error: Trying to combine an array with a non-array (' + prop + ')';                            // 55\n          } else {                                                                                                // 56\n            obj[prop] = _.reject(DeepExtend(obj[prop], source[prop]), function (item) { return _.isNull(item);});\n          }                                                                                                       // 58\n        }                                                                                                         // 59\n        else if (_.isObject(obj[prop]) || _.isObject(source[prop])){                                              // 60\n          if (!_.isObject(obj[prop]) || !_.isObject(source[prop])){                                               // 61\n            throw 'Error: Trying to combine an object with a non-object (' + prop + ')';                          // 62\n          } else {                                                                                                // 63\n            obj[prop] = DeepExtend(obj[prop], source[prop]);                                                      // 64\n          }                                                                                                       // 65\n        } else {                                                                                                  // 66\n          obj[prop] = source[prop];                                                                               // 67\n        }                                                                                                         // 68\n      }                                                                                                           // 69\n    }                                                                                                             // 70\n  });                                                                                                             // 71\n  return obj;                                                                                                     // 72\n};                                                                                                                // 73\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n\n\n\n\n(function(){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                //\n// packages/meteorhacks_fast-render/lib/client/id_tools.js                                                        //\n//                                                                                                                //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                  //\nIDTools = {};                                                                                                     // 1\nIDTools.idParse = LocalCollection._idParse;                                                                       // 2\nIDTools.idStringify = LocalCollection._idStringify;                                                               // 3\nIDTools.ObjectID = LocalCollection._ObjectID                                                                      // 4\n                                                                                                                  // 5\n// To support Meteor 1.2                                                                                          // 6\nif(Package['mongo-id']) {                                                                                         // 7\n  var MongoID = Package['mongo-id'].MongoID;                                                                      // 8\n  IDTools.idParse = MongoID.idParse;                                                                              // 9\n  IDTools.idStringify = MongoID.idStringify;                                                                      // 10\n  IDTools.ObjectID = MongoID.ObjectID;                                                                            // 11\n}                                                                                                                 // 12\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n\n\n\n\n(function(){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                //\n// packages/meteorhacks_fast-render/lib/client/fast_render.js                                                     //\n//                                                                                                                //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                  //\nFastRender = {};                                                                                                  // 1\nFastRender.enabled = typeof __fast_render_config != 'undefined';                                                  // 2\nFastRender._dataReceived = false;                                                                                 // 3\nFastRender._revertedBackToOriginal = false;                                                                       // 4\nFastRender._blockDDP = Meteor._localStorage.getItem('__frblockddp') != undefined;                                 // 5\nif(FastRender._blockDDP) {                                                                                        // 6\n  console.log(\"FastRender is blocking DDP messages. apply 'FastRender.debugger.unblockDDP()' to unblock again.\");\n}                                                                                                                 // 8\n                                                                                                                  // 9\nFastRender._disable = Meteor._localStorage.getItem('__frdisable') != undefined;                                   // 10\nif(FastRender._disable) {                                                                                         // 11\n  console.log(\"FastRender is disabled. apply 'FastRender.debugger.enableFR()' to enable it back.\")                // 12\n}                                                                                                                 // 13\n                                                                                                                  // 14\n// This allow us to apply DDP message even if Meteor block accepting messages                                     // 15\n//  When doing initial login, Meteor sends an login message                                                       // 16\n//  Then it'll block the accpeting DDP messages from server                                                       // 17\n//  This is the cure                                                                                              // 18\nFastRender.injectDdpMessage = function(conn, message) {                                                           // 19\n  FastRender[\"debugger\"].log('injecting ddp message:', message);                                                  // 20\n  var originalWait = conn._waitingForQuiescence;                                                                  // 21\n  conn._waitingForQuiescence = function() {return false};                                                         // 22\n  conn._livedata_data(message);                                                                                   // 23\n  conn._waitingForQuiescence = originalWait;                                                                      // 24\n};                                                                                                                // 25\n                                                                                                                  // 26\nFastRender.init = function(payload) {                                                                             // 27\n  if(FastRender._disable) return;                                                                                 // 28\n                                                                                                                  // 29\n  FastRender._securityCheck(payload);                                                                             // 30\n                                                                                                                  // 31\n  FastRender._subscriptions = (payload && payload.subscriptions) || {};                                           // 32\n  FastRender._subscriptionIdMap = {};                                                                             // 33\n  FastRender._dataReceived = true;                                                                                // 34\n  FastRender._payload = payload;                                                                                  // 35\n                                                                                                                  // 36\n  // merging data from different subscriptions                                                                    // 37\n  //  yes, this is a minimal mergeBox on the client                                                               // 38\n  var allData = {};                                                                                               // 39\n  if (payload) {                                                                                                  // 40\n    _.each(payload.collectionData, function(subData, collName) {                                                  // 41\n      if(!allData[collName]) {                                                                                    // 42\n        allData[collName] = {};                                                                                   // 43\n      }                                                                                                           // 44\n      collData = allData[collName];                                                                               // 45\n                                                                                                                  // 46\n      subData.forEach(function(dataSet) {                                                                         // 47\n        dataSet.forEach(function(item) {                                                                          // 48\n          if(!collData[item._id]) {                                                                               // 49\n            collData[item._id] = item;                                                                            // 50\n          } else {                                                                                                // 51\n            DeepExtend(collData[item._id], item);                                                                 // 52\n          }                                                                                                       // 53\n        });                                                                                                       // 54\n      });                                                                                                         // 55\n    });                                                                                                           // 56\n  }                                                                                                               // 57\n                                                                                                                  // 58\n  _.each(allData, function(collData, collName) {                                                                  // 59\n    _.each(collData, function(item, id) {                                                                         // 60\n      var id = IDTools.idStringify(item._id);                                                                     // 61\n      delete item._id;                                                                                            // 62\n                                                                                                                  // 63\n      var ddpMessage = {                                                                                          // 64\n        msg: 'added',                                                                                             // 65\n        collection: collName,                                                                                     // 66\n        id: id,                                                                                                   // 67\n        fields: item,                                                                                             // 68\n        frGen: true                                                                                               // 69\n      };                                                                                                          // 70\n                                                                                                                  // 71\n      FastRender.injectDdpMessage(Meteor.connection, ddpMessage);                                                 // 72\n    });                                                                                                           // 73\n  });                                                                                                             // 74\n                                                                                                                  // 75\n  // let Meteor know, user login process has been completed                                                       // 76\n  if(typeof Accounts != 'undefined') {                                                                            // 77\n    Accounts._setLoggingIn(false);                                                                                // 78\n  }                                                                                                               // 79\n};                                                                                                                // 80\n                                                                                                                  // 81\nFastRender._securityCheck = function(payload) {                                                                   // 82\n  if(payload && payload.loginToken) {                                                                             // 83\n    var localStorageLoginToken = Meteor._localStorage.getItem('Meteor.loginToken');                               // 84\n    if(localStorageLoginToken != payload.loginToken) {                                                            // 85\n      throw new Error(\"seems like cookie tossing is happening. visit here: http://git.io/q4IRHQ\");                // 86\n    }                                                                                                             // 87\n  }                                                                                                               // 88\n};                                                                                                                // 89\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n\n\n\n\n(function(){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                //\n// packages/meteorhacks_fast-render/lib/client/debugger.js                                                        //\n//                                                                                                                //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                  //\nFastRender[\"debugger\"] = {};                                                                                      // 1\nFastRender[\"debugger\"]._logs = [];                                                                                // 2\nFastRender[\"debugger\"].log = function function_name(message/*, args..*/) {                                        // 3\n  if(                                                                                                             // 4\n    typeof console != 'undefined' &&                                                                              // 5\n    typeof Meteor._localStorage != 'undefined' &&                                                                 // 6\n    Meteor._localStorage.getItem('__frlog') == \"1\")                                                               // 7\n  {                                                                                                               // 8\n    FastRender[\"debugger\"]._logs.push(arguments);                                                                 // 9\n    arguments[0] = \"FR: \" + arguments[0];                                                                         // 10\n    console.log.apply(console, arguments);                                                                        // 11\n  }                                                                                                               // 12\n}                                                                                                                 // 13\n                                                                                                                  // 14\nFastRender[\"debugger\"].showLogs = function() {                                                                    // 15\n  Meteor._localStorage.setItem('__frlog', \"1\");                                                                   // 16\n  location.reload();                                                                                              // 17\n};                                                                                                                // 18\n                                                                                                                  // 19\nFastRender[\"debugger\"].hideLogs = function() {                                                                    // 20\n  Meteor._localStorage.removeItem('__frlog');                                                                     // 21\n  location.reload();                                                                                              // 22\n};                                                                                                                // 23\n                                                                                                                  // 24\nFastRender[\"debugger\"].getLogs = function() {                                                                     // 25\n  return FastRender[\"debugger\"]._logs;                                                                            // 26\n};                                                                                                                // 27\n                                                                                                                  // 28\nFastRender[\"debugger\"].getLogsJSON = function() {                                                                 // 29\n  return JSON.stringify(FastRender[\"debugger\"]._logs);                                                            // 30\n};                                                                                                                // 31\n                                                                                                                  // 32\nFastRender[\"debugger\"].blockDDP = function() {                                                                    // 33\n  Meteor._localStorage.setItem('__frblockddp', \"1\");                                                              // 34\n  location.reload();                                                                                              // 35\n};                                                                                                                // 36\n                                                                                                                  // 37\nFastRender[\"debugger\"].unblockDDP = function() {                                                                  // 38\n  Meteor._localStorage.removeItem('__frblockddp');                                                                // 39\n  location.reload();                                                                                              // 40\n};                                                                                                                // 41\n                                                                                                                  // 42\nFastRender[\"debugger\"].disableFR = function() {                                                                   // 43\n  Meteor._localStorage.setItem('__frdisable', \"1\");                                                               // 44\n  location.reload();                                                                                              // 45\n};                                                                                                                // 46\n                                                                                                                  // 47\nFastRender[\"debugger\"].enableFR = function() {                                                                    // 48\n  Meteor._localStorage.removeItem('__frdisable');                                                                 // 49\n  location.reload();                                                                                              // 50\n};                                                                                                                // 51\n                                                                                                                  // 52\nFastRender[\"debugger\"].getPayload = function() {                                                                  // 53\n  return FastRender._payload;                                                                                     // 54\n};                                                                                                                // 55\n                                                                                                                  // 56\nFastRender[\"debugger\"].getPayloadJSON = function() {                                                              // 57\n  return JSON.stringify(FastRender._payload);                                                                     // 58\n};                                                                                                                // 59\n                                                                                                                  // 60\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n\n\n\n\n(function(){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                //\n// packages/meteorhacks_fast-render/lib/client/ddp_update.js                                                      //\n//                                                                                                                //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                  //\nvar reconnecting = false;                                                                                         // 1\n                                                                                                                  // 2\nvar originalLivedataData = Meteor.connection._livedata_data;                                                      // 3\nMeteor.connection._livedata_data = function(msg) {                                                                // 4\n  if(FastRender._blockDDP && !msg.frGen) {                                                                        // 5\n    FastRender[\"debugger\"].log('blocking incoming ddp', msg);                                                     // 6\n    return;                                                                                                       // 7\n  };                                                                                                              // 8\n  // fast-render adds data manually while initializing                                                            // 9\n  // But when the server sends actual data via DDP, it also tries to add                                          // 10\n  // Then we need to detect that and alter                                                                        // 11\n  //                                                                                                              // 12\n  // But we don't need to interfer with Meteor's simulation process                                               // 13\n  // That's why we are checking for serverDocs and ignore manual handling                                         // 14\n  //                                                                                                              // 15\n  // We don't need this logic after our special handling reverted back to                                         // 16\n  // original. But we can't detect when null publications completed or not                                        // 17\n  // That's why we need keep this logic                                                                           // 18\n  //                                                                                                              // 19\n  // It's okay to ignore this logic after sometime, but not sure when exactly                                     // 20\n                                                                                                                  // 21\n  if(msg.msg == 'added') {                                                                                        // 22\n    var id = IDTools.idParse(msg.id);                                                                             // 23\n    var serverDoc = this._getServerDoc(msg.collection, id);                                                       // 24\n                                                                                                                  // 25\n    if(!reconnecting && !serverDoc) {                                                                             // 26\n      var localCollection = this._mongo_livedata_collections[msg.collection];                                     // 27\n      var pendingStoreUpdates = this._updatesForUnknownStores[msg.collection];                                    // 28\n      if(localCollection) {                                                                                       // 29\n        var existingDoc = localCollection.findOne(id);                                                            // 30\n        if(existingDoc) {                                                                                         // 31\n          FastRender[\"debugger\"].log('re writing DDP for:', msg);                                                 // 32\n          AddedToChanged(existingDoc, msg);                                                                       // 33\n        }                                                                                                         // 34\n      } else if(pendingStoreUpdates) {                                                                            // 35\n        var mergedDoc = null;                                                                                     // 36\n        var existingDocs = _.filter(pendingStoreUpdates, function(doc) {                                          // 37\n          return doc.id == msg.id;                                                                                // 38\n        });                                                                                                       // 39\n                                                                                                                  // 40\n        _.each(existingDocs, function(cachedMsg) {                                                                // 41\n          mergedDoc = ApplyDDP(mergedDoc, cachedMsg);                                                             // 42\n        });                                                                                                       // 43\n                                                                                                                  // 44\n        if(mergedDoc) {                                                                                           // 45\n          FastRender[\"debugger\"].log('re writing DDP for:', msg);                                                 // 46\n          AddedToChanged(mergedDoc, msg);                                                                         // 47\n        }                                                                                                         // 48\n      }                                                                                                           // 49\n    }                                                                                                             // 50\n  }                                                                                                               // 51\n                                                                                                                  // 52\n  // if we've completed our tasks, no need of special handling                                                    // 53\n  if(!FastRender._revertedBackToOriginal && FastRender._dataReceived) {                                           // 54\n                                                                                                                  // 55\n    // This will take care of cleaning special subscription handling                                              // 56\n    // after the actual subscription comes out                                                                    // 57\n    if(msg.msg == 'ready' && !msg.frGen && FastRender._subscriptions) {                                           // 58\n      msg.subs.forEach(function(subId) {                                                                          // 59\n        var subscription = FastRender._subscriptionIdMap[subId];                                                  // 60\n        if(subscription) {                                                                                        // 61\n          FastRender[\"debugger\"].log('actual subscription completed:', subscription, subId);                      // 62\n          // we don't need to handle specially after this                                                         // 63\n          var paramsKeyMap = FastRender._subscriptions[subscription.name] || {};                                  // 64\n          delete paramsKeyMap[subscription.paramsKey];                                                            // 65\n          if(EJSON.equals(FastRender._subscriptions[subscription.name], {})) {                                    // 66\n            delete FastRender._subscriptions[subscription.name];                                                  // 67\n          }                                                                                                       // 68\n          delete FastRender._subscriptionIdMap[subId];                                                            // 69\n        }                                                                                                         // 70\n      });                                                                                                         // 71\n    }                                                                                                             // 72\n                                                                                                                  // 73\n    // if all the subscriptions have been processed,                                                              // 74\n    // there is no need to keep hijacking                                                                         // 75\n    if(EJSON.equals(FastRender._subscriptions, {})) {                                                             // 76\n      FastRender[\"debugger\"].log('fast rendering completed!');                                                    // 77\n      FastRender._revertedBackToOriginal = true;                                                                  // 78\n    }                                                                                                             // 79\n  }                                                                                                               // 80\n                                                                                                                  // 81\n  return originalLivedataData.call(this, msg);                                                                    // 82\n};                                                                                                                // 83\n                                                                                                                  // 84\nvar originalSend = Meteor.connection._send;                                                                       // 85\nMeteor.connection._send = function(msg) {                                                                         // 86\n  // if looking for connect again to the server, we must need to revert back to                                   // 87\n  // original to prevent some weird DDP issues                                                                    // 88\n  //  normally it is already reverted, but user may added subscriptions                                           // 89\n  //  in server, which are not subscribed from the client                                                         // 90\n  if(msg.msg == 'connect' && msg.session != undefined) {                                                          // 91\n    FastRender._revertedBackToOriginal = true;                                                                    // 92\n    reconnecting = true;                                                                                          // 93\n  }                                                                                                               // 94\n                                                                                                                  // 95\n  var self = this;                                                                                                // 96\n                                                                                                                  // 97\n  // if we've completed our tasks, no need of special handling                                                    // 98\n  if(!FastRender._revertedBackToOriginal && FastRender._dataReceived) {                                           // 99\n    var paramsKey = EJSON.stringify(msg.params);                                                                  // 100\n    var canSendFakeReady =                                                                                        // 101\n      msg.msg == 'sub' &&                                                                                         // 102\n      FastRender._subscriptions[msg.name] &&                                                                      // 103\n      FastRender._subscriptions[msg.name][paramsKey];                                                             // 104\n                                                                                                                  // 105\n    FastRender[\"debugger\"].log('new subscription:', msg.name);                                                    // 106\n    if(canSendFakeReady) {                                                                                        // 107\n      FastRender[\"debugger\"].log('sending fake ready for sub:', msg.name);                                        // 108\n      FastRender.injectDdpMessage(self, {msg:\"ready\",subs:[msg.id], frGen: true});                                // 109\n      // add the messageId to be handled later                                                                    // 110\n      FastRender._subscriptionIdMap[msg.id] = {                                                                   // 111\n        name: msg.name,                                                                                           // 112\n        paramsKey: paramsKey                                                                                      // 113\n      };                                                                                                          // 114\n    }                                                                                                             // 115\n  }                                                                                                               // 116\n                                                                                                                  // 117\n  return originalSend.call(this, msg);                                                                            // 118\n};                                                                                                                // 119\n                                                                                                                  // 120\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n\n\n\n\n(function(){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                //\n// packages/meteorhacks_fast-render/lib/client/auth.js                                                            //\n//                                                                                                                //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                  //\n// getting tokens for the first time                                                                              // 1\n//  Meteor calls Meteor._localStorage.setItem() on the boot                                                       // 2\n//  But we can do it ourselves also with this                                                                     // 3\nMeteor.startup(function() {                                                                                       // 4\n  resetToken();                                                                                                   // 5\n});                                                                                                               // 6\n                                                                                                                  // 7\n// override Meteor._localStorage methods and resetToken accordingly                                               // 8\nvar originalSetItem = Meteor._localStorage.setItem;                                                               // 9\nMeteor._localStorage.setItem = function(key, value) {                                                             // 10\n  if(key == 'Meteor.loginToken') {                                                                                // 11\n    Meteor.defer(resetToken);                                                                                     // 12\n  }                                                                                                               // 13\n  originalSetItem.call(Meteor._localStorage, key, value);                                                         // 14\n};                                                                                                                // 15\n                                                                                                                  // 16\nvar originalRemoveItem = Meteor._localStorage.removeItem;                                                         // 17\nMeteor._localStorage.removeItem = function(key) {                                                                 // 18\n  if(key == 'Meteor.loginToken') {                                                                                // 19\n    Meteor.defer(resetToken);                                                                                     // 20\n  }                                                                                                               // 21\n  originalRemoveItem.call(Meteor._localStorage, key);                                                             // 22\n}                                                                                                                 // 23\n                                                                                                                  // 24\nfunction resetToken() {                                                                                           // 25\n  var loginToken = Meteor._localStorage.getItem('Meteor.loginToken');                                             // 26\n  var loginTokenExpires = new Date(Meteor._localStorage.getItem('Meteor.loginTokenExpires'));                     // 27\n                                                                                                                  // 28\n  if(loginToken) {                                                                                                // 29\n    setToken(loginToken, loginTokenExpires);                                                                      // 30\n  } else {                                                                                                        // 31\n    setToken(null, -1);                                                                                           // 32\n  }                                                                                                               // 33\n}                                                                                                                 // 34\n                                                                                                                  // 35\nfunction setToken(loginToken, expires) {                                                                          // 36\n  Cookie.set('meteor_login_token', loginToken, {                                                                  // 37\n    path: '/',                                                                                                    // 38\n    expires: expires                                                                                              // 39\n  });                                                                                                             // 40\n}                                                                                                                 // 41\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n\n\n\n\n(function(){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                //\n// packages/meteorhacks_fast-render/lib/client/boot.js                                                            //\n//                                                                                                                //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                  //\nInjectData.getData('fast-render-data', function(payload) {                                                        // 1\n  FastRender.init(payload);                                                                                       // 2\n});                                                                                                               // 3\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n/* Exports */\nif (typeof Package === 'undefined') Package = {};\nPackage['meteorhacks:fast-render'] = {\n  FastRender: FastRender,\n  __init_fast_render: __init_fast_render\n};\n\n})();\n","servePath":"/packages/meteorhacks_fast-render.js","sourceMap":{"version":3,"sources":["/packages/meteorhacks_fast-render/lib/utils.js","/packages/meteorhacks_fast-render/lib/client/id_tools.js","/packages/meteorhacks_fast-render/lib/client/fast_render.js","/packages/meteorhacks_fast-render/lib/client/debugger.js","/packages/meteorhacks_fast-render/lib/client/ddp_update.js","/packages/meteorhacks_fast-render/lib/client/auth.js","/packages/meteorhacks_fast-render/lib/client/boot.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uH;;;;;;;;;;;;;;;;;;ACxEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uH;;;;;;;;;;;;;;;;;;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uH;;;;;;;;;;;;;;;;;;ACxFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uH;;;;;;;;;;;;;;;;;;AC3DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wH;;;;;;;;;;;;;;;;;;ACvHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uH;;;;;;;;;;;;;;;;;;ACxCA;AACA;AACA,sH","file":"/packages/meteorhacks_fast-render.js","sourcesContent":["AddedToChanged = function(localCopy, added) {\n  added.msg = \"changed\";\n  added.cleared = [];\n  added.fields = added.fields || {};\n\n  _.each(localCopy, function(value, key) {\n    if(key != '_id') {\n      if(typeof added.fields[key] == \"undefined\") {\n        added.cleared.push(key);\n      }\n    }\n  });\n};\n\nApplyDDP = function(existing, message) {\n  var newDoc = (!existing)? {}: _.clone(existing);\n  if(message.msg == 'added') {\n    _.each(message.fields, function(value, key) {\n      newDoc[key] = value;\n    });\n  } else if(message.msg == \"changed\") {\n    _.each(message.fields, function(value, key) {\n      newDoc[key] = value;\n    });\n    _.each(message.cleared, function(key) {\n      delete newDoc[key];\n    });\n  } else if(message.msg == \"removed\") {\n    newDoc = null;\n  }\n\n  return newDoc;\n};\n\n// source: https://gist.github.com/kurtmilam/1868955\n//  modified a bit to not to expose this as an _ api\nDeepExtend = function deepExtend (obj) {\n  var parentRE = /#{\\s*?_\\s*?}/,\n      slice = Array.prototype.slice,\n      hasOwnProperty = Object.prototype.hasOwnProperty;\n\n  _.each(slice.call(arguments, 1), function(source) {\n    for (var prop in source) {\n      if (hasOwnProperty.call(source, prop)) {\n        if (_.isNull(obj[prop]) || _.isUndefined(obj[prop]) || _.isFunction(obj[prop]) || _.isNull(source[prop]) || _.isDate(source[prop])) {\n          obj[prop] = source[prop];\n        }\n        else if (_.isString(source[prop]) && parentRE.test(source[prop])) {\n          if (_.isString(obj[prop])) {\n            obj[prop] = source[prop].replace(parentRE, obj[prop]);\n          }\n        }\n        else if (_.isArray(obj[prop]) || _.isArray(source[prop])){\n          if (!_.isArray(obj[prop]) || !_.isArray(source[prop])){\n            throw 'Error: Trying to combine an array with a non-array (' + prop + ')';\n          } else {\n            obj[prop] = _.reject(DeepExtend(obj[prop], source[prop]), function (item) { return _.isNull(item);});\n          }\n        }\n        else if (_.isObject(obj[prop]) || _.isObject(source[prop])){\n          if (!_.isObject(obj[prop]) || !_.isObject(source[prop])){\n            throw 'Error: Trying to combine an object with a non-object (' + prop + ')';\n          } else {\n            obj[prop] = DeepExtend(obj[prop], source[prop]);\n          }\n        } else {\n          obj[prop] = source[prop];\n        }\n      }\n    }\n  });\n  return obj;\n};","IDTools = {};\nIDTools.idParse = LocalCollection._idParse;\nIDTools.idStringify = LocalCollection._idStringify;\nIDTools.ObjectID = LocalCollection._ObjectID\n\n// To support Meteor 1.2\nif(Package['mongo-id']) {\n  var MongoID = Package['mongo-id'].MongoID;\n  IDTools.idParse = MongoID.idParse;\n  IDTools.idStringify = MongoID.idStringify;\n  IDTools.ObjectID = MongoID.ObjectID;\n}","FastRender = {};\nFastRender.enabled = typeof __fast_render_config != 'undefined';\nFastRender._dataReceived = false;\nFastRender._revertedBackToOriginal = false;\nFastRender._blockDDP = Meteor._localStorage.getItem('__frblockddp') != undefined;\nif(FastRender._blockDDP) {\n  console.log(\"FastRender is blocking DDP messages. apply 'FastRender.debugger.unblockDDP()' to unblock again.\");\n}\n\nFastRender._disable = Meteor._localStorage.getItem('__frdisable') != undefined;\nif(FastRender._disable) {\n  console.log(\"FastRender is disabled. apply 'FastRender.debugger.enableFR()' to enable it back.\")\n}\n\n// This allow us to apply DDP message even if Meteor block accepting messages\n//  When doing initial login, Meteor sends an login message\n//  Then it'll block the accpeting DDP messages from server\n//  This is the cure\nFastRender.injectDdpMessage = function(conn, message) {\n  FastRender[\"debugger\"].log('injecting ddp message:', message);\n  var originalWait = conn._waitingForQuiescence;\n  conn._waitingForQuiescence = function() {return false};\n  conn._livedata_data(message);\n  conn._waitingForQuiescence = originalWait;\n};\n\nFastRender.init = function(payload) {\n  if(FastRender._disable) return;\n\n  FastRender._securityCheck(payload);\n\n  FastRender._subscriptions = (payload && payload.subscriptions) || {};\n  FastRender._subscriptionIdMap = {};\n  FastRender._dataReceived = true;\n  FastRender._payload = payload;\n\n  // merging data from different subscriptions\n  //  yes, this is a minimal mergeBox on the client\n  var allData = {};\n  if (payload) {\n    _.each(payload.collectionData, function(subData, collName) {\n      if(!allData[collName]) {\n        allData[collName] = {};\n      }\n      collData = allData[collName];\n\n      subData.forEach(function(dataSet) {\n        dataSet.forEach(function(item) {\n          if(!collData[item._id]) {\n            collData[item._id] = item;\n          } else {\n            DeepExtend(collData[item._id], item);\n          }\n        });\n      });\n    });\n  }\n\n  _.each(allData, function(collData, collName) {\n    _.each(collData, function(item, id) {\n      var id = IDTools.idStringify(item._id);\n      delete item._id;\n\n      var ddpMessage = {\n        msg: 'added',\n        collection: collName,\n        id: id,\n        fields: item,\n        frGen: true\n      };\n\n      FastRender.injectDdpMessage(Meteor.connection, ddpMessage);\n    });\n  });\n\n  // let Meteor know, user login process has been completed\n  if(typeof Accounts != 'undefined') {\n    Accounts._setLoggingIn(false);\n  }\n};\n\nFastRender._securityCheck = function(payload) {\n  if(payload && payload.loginToken) {\n    var localStorageLoginToken = Meteor._localStorage.getItem('Meteor.loginToken');\n    if(localStorageLoginToken != payload.loginToken) {\n      throw new Error(\"seems like cookie tossing is happening. visit here: http://git.io/q4IRHQ\");\n    }\n  }\n};","FastRender[\"debugger\"] = {};\nFastRender[\"debugger\"]._logs = [];\nFastRender[\"debugger\"].log = function function_name(message/*, args..*/) {\n  if(\n    typeof console != 'undefined' &&\n    typeof Meteor._localStorage != 'undefined' && \n    Meteor._localStorage.getItem('__frlog') == \"1\") \n  {\n    FastRender[\"debugger\"]._logs.push(arguments);\n    arguments[0] = \"FR: \" + arguments[0];\n    console.log.apply(console, arguments);\n  }\n}\n\nFastRender[\"debugger\"].showLogs = function() {\n  Meteor._localStorage.setItem('__frlog', \"1\");\n  location.reload();\n};\n\nFastRender[\"debugger\"].hideLogs = function() {\n  Meteor._localStorage.removeItem('__frlog');\n  location.reload();\n};\n\nFastRender[\"debugger\"].getLogs = function() {\n  return FastRender[\"debugger\"]._logs;\n};\n\nFastRender[\"debugger\"].getLogsJSON = function() {\n  return JSON.stringify(FastRender[\"debugger\"]._logs);\n};\n\nFastRender[\"debugger\"].blockDDP = function() {\n  Meteor._localStorage.setItem('__frblockddp', \"1\");\n  location.reload();\n};\n\nFastRender[\"debugger\"].unblockDDP = function() {\n  Meteor._localStorage.removeItem('__frblockddp');\n  location.reload();\n};\n\nFastRender[\"debugger\"].disableFR = function() {\n  Meteor._localStorage.setItem('__frdisable', \"1\");\n  location.reload();\n};\n\nFastRender[\"debugger\"].enableFR = function() {\n  Meteor._localStorage.removeItem('__frdisable');\n  location.reload();\n};\n\nFastRender[\"debugger\"].getPayload = function() {\n  return FastRender._payload;\n};\n\nFastRender[\"debugger\"].getPayloadJSON = function() {\n  return JSON.stringify(FastRender._payload);\n};\n","var reconnecting = false;\n\nvar originalLivedataData = Meteor.connection._livedata_data;\nMeteor.connection._livedata_data = function(msg) {\n  if(FastRender._blockDDP && !msg.frGen) {\n    FastRender[\"debugger\"].log('blocking incoming ddp', msg);\n    return;\n  };\n  // fast-render adds data manually while initializing\n  // But when the server sends actual data via DDP, it also tries to add\n  // Then we need to detect that and alter\n  //\n  // But we don't need to interfer with Meteor's simulation process\n  // That's why we are checking for serverDocs and ignore manual handling\n  //\n  // We don't need this logic after our special handling reverted back to\n  // original. But we can't detect when null publications completed or not\n  // That's why we need keep this logic\n  //\n  // It's okay to ignore this logic after sometime, but not sure when exactly\n\n  if(msg.msg == 'added') {\n    var id = IDTools.idParse(msg.id);\n    var serverDoc = this._getServerDoc(msg.collection, id);\n    \n    if(!reconnecting && !serverDoc) {\n      var localCollection = this._mongo_livedata_collections[msg.collection];\n      var pendingStoreUpdates = this._updatesForUnknownStores[msg.collection];\n      if(localCollection) {\n        var existingDoc = localCollection.findOne(id);\n        if(existingDoc) {\n          FastRender[\"debugger\"].log('re writing DDP for:', msg);\n          AddedToChanged(existingDoc, msg);\n        }\n      } else if(pendingStoreUpdates) {\n        var mergedDoc = null;\n        var existingDocs = _.filter(pendingStoreUpdates, function(doc) {\n          return doc.id == msg.id;\n        });\n\n        _.each(existingDocs, function(cachedMsg) {\n          mergedDoc = ApplyDDP(mergedDoc, cachedMsg);\n        });\n        \n        if(mergedDoc) {\n          FastRender[\"debugger\"].log('re writing DDP for:', msg);\n          AddedToChanged(mergedDoc, msg);\n        }\n      }\n    }\n  }\n\n  // if we've completed our tasks, no need of special handling\n  if(!FastRender._revertedBackToOriginal && FastRender._dataReceived) {\n\n    // This will take care of cleaning special subscription handling\n    // after the actual subscription comes out\n    if(msg.msg == 'ready' && !msg.frGen && FastRender._subscriptions) {\n      msg.subs.forEach(function(subId) {\n        var subscription = FastRender._subscriptionIdMap[subId];\n        if(subscription) {\n          FastRender[\"debugger\"].log('actual subscription completed:', subscription, subId);\n          // we don't need to handle specially after this\n          var paramsKeyMap = FastRender._subscriptions[subscription.name] || {};\n          delete paramsKeyMap[subscription.paramsKey];\n          if(EJSON.equals(FastRender._subscriptions[subscription.name], {})) {\n            delete FastRender._subscriptions[subscription.name];\n          }\n          delete FastRender._subscriptionIdMap[subId];\n        }\n      });\n    }\n\n    // if all the subscriptions have been processed,\n    // there is no need to keep hijacking\n    if(EJSON.equals(FastRender._subscriptions, {})) {\n      FastRender[\"debugger\"].log('fast rendering completed!');\n      FastRender._revertedBackToOriginal = true;\n    }\n  }\n\n  return originalLivedataData.call(this, msg);\n};\n\nvar originalSend = Meteor.connection._send;\nMeteor.connection._send = function(msg) {\n  // if looking for connect again to the server, we must need to revert back to\n  // original to prevent some weird DDP issues\n  //  normally it is already reverted, but user may added subscriptions\n  //  in server, which are not subscribed from the client\n  if(msg.msg == 'connect' && msg.session != undefined) {\n    FastRender._revertedBackToOriginal = true;\n    reconnecting = true;\n  }\n\n  var self = this;\n\n  // if we've completed our tasks, no need of special handling\n  if(!FastRender._revertedBackToOriginal && FastRender._dataReceived) {\n    var paramsKey = EJSON.stringify(msg.params);\n    var canSendFakeReady =\n      msg.msg == 'sub' &&\n      FastRender._subscriptions[msg.name] &&\n      FastRender._subscriptions[msg.name][paramsKey];\n\n    FastRender[\"debugger\"].log('new subscription:', msg.name);\n    if(canSendFakeReady) {\n      FastRender[\"debugger\"].log('sending fake ready for sub:', msg.name);\n      FastRender.injectDdpMessage(self, {msg:\"ready\",subs:[msg.id], frGen: true});\n      // add the messageId to be handled later\n      FastRender._subscriptionIdMap[msg.id] = {\n        name: msg.name,\n        paramsKey: paramsKey\n      };\n    }\n  }\n\n  return originalSend.call(this, msg);\n};\n","// getting tokens for the first time\n//  Meteor calls Meteor._localStorage.setItem() on the boot\n//  But we can do it ourselves also with this\nMeteor.startup(function() {\n  resetToken();\n});\n\n// override Meteor._localStorage methods and resetToken accordingly\nvar originalSetItem = Meteor._localStorage.setItem;\nMeteor._localStorage.setItem = function(key, value) {\n  if(key == 'Meteor.loginToken') {\n    Meteor.defer(resetToken);\n  }\n  originalSetItem.call(Meteor._localStorage, key, value);\n};\n\nvar originalRemoveItem = Meteor._localStorage.removeItem;\nMeteor._localStorage.removeItem = function(key) {\n  if(key == 'Meteor.loginToken') {\n    Meteor.defer(resetToken);\n  }\n  originalRemoveItem.call(Meteor._localStorage, key);\n}\n\nfunction resetToken() {\n  var loginToken = Meteor._localStorage.getItem('Meteor.loginToken');\n  var loginTokenExpires = new Date(Meteor._localStorage.getItem('Meteor.loginTokenExpires'));\n\n  if(loginToken) {\n    setToken(loginToken, loginTokenExpires);\n  } else {\n    setToken(null, -1);\n  }\n}\n\nfunction setToken(loginToken, expires) {\n  Cookie.set('meteor_login_token', loginToken, {\n    path: '/',\n    expires: expires\n  });\n}","InjectData.getData('fast-render-data', function(payload) {\n  FastRender.init(payload);\n});"]}}]