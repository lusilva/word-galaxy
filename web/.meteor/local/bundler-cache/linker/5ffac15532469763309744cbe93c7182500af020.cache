[{"type":"js","data":"(function () {\n\n/* Imports */\nvar Meteor = Package.meteor.Meteor;\nvar RateLimiter = Package['rate-limit'].RateLimiter;\n\n/* Package-scope variables */\nvar DDPRateLimiter;\n\n(function(){\n\n//////////////////////////////////////////////////////////////////////////////////\n//                                                                              //\n// packages/ddp-rate-limiter/ddp-rate-limiter.js                                //\n//                                                                              //\n//////////////////////////////////////////////////////////////////////////////////\n                                                                                //\n// Rate Limiter built into DDP with a default error message. See README or      // 1\n// online documentation for more details.                                       // 2\nDDPRateLimiter = {};                                                            // 3\n                                                                                // 4\nvar errorMessage = function (rateLimitResult) {                                 // 5\n  return \"Error, too many requests. Please slow down. You must wait \" +         // 6\n    Math.ceil(rateLimitResult.timeToReset / 1000) + \" seconds before \" +        // 7\n    \"trying again.\";                                                            // 8\n};                                                                              // 9\nvar rateLimiter = new RateLimiter();                                            // 10\n                                                                                // 11\nDDPRateLimiter.getErrorMessage = function (rateLimitResult) {                   // 12\n  if (typeof errorMessage === 'function')                                       // 13\n    return errorMessage(rateLimitResult);                                       // 14\n  else                                                                          // 15\n    return errorMessage;                                                        // 16\n};                                                                              // 17\n                                                                                // 18\n/**                                                                             // 19\n * @summary Set error message text when method or subscription rate limit       // 20\n * exceeded.                                                                    // 21\n * @param {string|function} message Functions are passed in an object with a    // 22\n * `timeToReset` field that specifies the number of milliseconds until the next\n * method or subscription is allowed to run. The function must return a string  // 24\n * of the error message.                                                        // 25\n */                                                                             // 26\nDDPRateLimiter.setErrorMessage = function (message) {                           // 27\n  errorMessage = message;                                                       // 28\n};                                                                              // 29\n                                                                                // 30\n/**                                                                             // 31\n * @summary                                                                     // 32\n * Add a rule that matches against a stream of events describing method or      // 33\n * subscription attempts. Each event is an object with the following            // 34\n * properties:                                                                  // 35\n *                                                                              // 36\n * - `type`: Either \"method\" or \"subscription\"                                  // 37\n * - `name`: The name of the method or subscription being called                // 38\n * - `userId`: The user ID attempting the method or subscription                // 39\n * - `connectionId`: A string representing the user's DDP connection            // 40\n * - `clientAddress`: The IP address of the user                                // 41\n *                                                                              // 42\n * Returns unique `ruleId` that can be passed to `removeRule`.                  // 43\n *                                                                              // 44\n * @param {Object} matcher                                                      // 45\n *   Matchers specify which events are counted towards a rate limit. A matcher  // 46\n *   is an object that has a subset of the same properties as the event objects\n *   described above. Each value in a matcher object is one of the following:   // 48\n *                                                                              // 49\n *   - a string: for the event to satisfy the matcher, this value must be equal\n *   to the value of the same property in the event object                      // 51\n *                                                                              // 52\n *   - a function: for the event to satisfy the matcher, the function must      // 53\n *   evaluate to true when passed the value of the same property                // 54\n *   in the event object                                                        // 55\n *                                                                              // 56\n * Here's how events are counted: Each event that satisfies the matcher's       // 57\n * filter is mapped to a bucket. Buckets are uniquely determined by the         // 58\n * event object's values for all properties present in both the matcher and     // 59\n * event objects.                                                               // 60\n *                                                                              // 61\n * @param {number} numRequests  number of requests allowed per time interval.   // 62\n * Default = 10.                                                                // 63\n * @param {number} timeInterval time interval in milliseconds after which       // 64\n * rule's counters are reset. Default = 1000.                                   // 65\n */                                                                             // 66\nDDPRateLimiter.addRule = function (matcher, numRequests, timeInterval) {        // 67\n  return rateLimiter.addRule(matcher, numRequests, timeInterval);               // 68\n};                                                                              // 69\n                                                                                // 70\nDDPRateLimiter.printRules = function () {                                       // 71\n  return rateLimiter.rules;                                                     // 72\n};                                                                              // 73\n                                                                                // 74\n/**                                                                             // 75\n * @summary Removes the specified rule from the rate limiter. If rule had       // 76\n * hit a rate limit, that limit is removed as well.                             // 77\n * @param  {string} id 'ruleId' returned from `addRule`                         // 78\n * @return {boolean}    True if a rule was removed.                             // 79\n */                                                                             // 80\nDDPRateLimiter.removeRule = function (id) {                                     // 81\n  return rateLimiter.removeRule(id);                                            // 82\n};                                                                              // 83\n                                                                                // 84\n// This is accessed inside livedata_server.js, but shouldn't be called by any   // 85\n// user.                                                                        // 86\nDDPRateLimiter._increment = function (input) {                                  // 87\n  rateLimiter.increment(input);                                                 // 88\n};                                                                              // 89\n                                                                                // 90\nDDPRateLimiter._check = function (input) {                                      // 91\n  return rateLimiter.check(input);                                              // 92\n};                                                                              // 93\n                                                                                // 94\n//////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n/* Exports */\nif (typeof Package === 'undefined') Package = {};\nPackage['ddp-rate-limiter'] = {\n  DDPRateLimiter: DDPRateLimiter\n};\n\n})();\n","servePath":"/packages/ddp-rate-limiter.js","sourceMap":{"version":3,"sources":["/packages/ddp-rate-limiter/ddp-rate-limiter.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qF","file":"/packages/ddp-rate-limiter.js","sourcesContent":["// Rate Limiter built into DDP with a default error message. See README or\n// online documentation for more details.\nDDPRateLimiter = {};\n\nvar errorMessage = function (rateLimitResult) {\n  return \"Error, too many requests. Please slow down. You must wait \" +\n    Math.ceil(rateLimitResult.timeToReset / 1000) + \" seconds before \" +\n    \"trying again.\";\n};\nvar rateLimiter = new RateLimiter();\n\nDDPRateLimiter.getErrorMessage = function (rateLimitResult) {\n  if (typeof errorMessage === 'function')\n    return errorMessage(rateLimitResult);\n  else\n    return errorMessage;\n};\n\n/**\n * @summary Set error message text when method or subscription rate limit\n * exceeded.\n * @param {string|function} message Functions are passed in an object with a\n * `timeToReset` field that specifies the number of milliseconds until the next\n * method or subscription is allowed to run. The function must return a string\n * of the error message.\n */\nDDPRateLimiter.setErrorMessage = function (message) {\n  errorMessage = message;\n};\n\n/**\n * @summary\n * Add a rule that matches against a stream of events describing method or\n * subscription attempts. Each event is an object with the following\n * properties:\n *\n * - `type`: Either \"method\" or \"subscription\"\n * - `name`: The name of the method or subscription being called\n * - `userId`: The user ID attempting the method or subscription\n * - `connectionId`: A string representing the user's DDP connection\n * - `clientAddress`: The IP address of the user\n *\n * Returns unique `ruleId` that can be passed to `removeRule`.\n *\n * @param {Object} matcher\n *   Matchers specify which events are counted towards a rate limit. A matcher\n *   is an object that has a subset of the same properties as the event objects\n *   described above. Each value in a matcher object is one of the following:\n *\n *   - a string: for the event to satisfy the matcher, this value must be equal\n *   to the value of the same property in the event object\n *\n *   - a function: for the event to satisfy the matcher, the function must\n *   evaluate to true when passed the value of the same property\n *   in the event object\n *\n * Here's how events are counted: Each event that satisfies the matcher's\n * filter is mapped to a bucket. Buckets are uniquely determined by the\n * event object's values for all properties present in both the matcher and\n * event objects.\n *\n * @param {number} numRequests  number of requests allowed per time interval.\n * Default = 10.\n * @param {number} timeInterval time interval in milliseconds after which\n * rule's counters are reset. Default = 1000.\n */\nDDPRateLimiter.addRule = function (matcher, numRequests, timeInterval) {\n  return rateLimiter.addRule(matcher, numRequests, timeInterval);\n};\n\nDDPRateLimiter.printRules = function () {\n  return rateLimiter.rules;\n};\n\n/**\n * @summary Removes the specified rule from the rate limiter. If rule had\n * hit a rate limit, that limit is removed as well.\n * @param  {string} id 'ruleId' returned from `addRule`\n * @return {boolean}    True if a rule was removed.\n */\nDDPRateLimiter.removeRule = function (id) {\n  return rateLimiter.removeRule(id);\n};\n\n// This is accessed inside livedata_server.js, but shouldn't be called by any\n// user.\nDDPRateLimiter._increment = function (input) {\n  rateLimiter.increment(input);\n};\n\nDDPRateLimiter._check = function (input) {\n  return rateLimiter.check(input);\n};\n"]}}]